<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Digital Dogs Australia">
    <meta name="author" content="Lucas Cullen">

    <title>Digital Dogs Australia</title>

    <!-- Bootstrap Core CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.2.1/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="./vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="./vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="./css/stylish-portfolio.min.css" rel="stylesheet">

  </head>

  <body id="page-top">

    <!-- Navigation -->
    <a class="menu-toggle rounded" href="#">
      <i class="fas fa-bars"></i>
    </a>
    <nav id="sidebar-wrapper">
      <ul class="sidebar-nav">
        <li class="sidebar-brand">
          <a class="js-scroll-trigger" href="#page-top">Menu</a>
        </li>
        <li class="sidebar-nav-item">
          <a class="js-scroll-trigger" href="#page-top">Home</a>
        </li>
        <li class="sidebar-nav-item">
          <a class="js-scroll-trigger" href="#about">About</a>
        </li>
        <li class="sidebar-nav-item">
          <a class="js-scroll-trigger" href="#services">Services</a>
        </li>
        <li class="sidebar-nav-item">
          <a class="js-scroll-trigger" href="#portfolio">Portfolio</a>
        </li>
        <li class="sidebar-nav-item">
          <a class="js-scroll-trigger" href="#contact">Contact</a>
        </li>
      </ul>
    </nav>

    <!-- Header -->
    <header class="masthead d-flex">
      <div class="container text-center my-auto">
        <h1 class="mb-1">Digital Dogs Australia &#x1F43A</h1>
        <h3 class="mb-5">
          <em>Proovable lineage on the ethereum blockchain <i class="fab fa-ethereum"></i></em>
        </h3>
        <a class="btn btn-primary btn-xl js-scroll-trigger" href="#about">Coming soon!</a>
      </div>
      <div class="overlay"></div>
    </header>

    <!-- About -->
    <section class="content-section bg-light" id="about">
      <div class="container text-center">
        <div class="row">
          <div class="col-lg-10 mx-auto">
            <h2>What we do <i class="fa fa-paw"></i></h2>
            <p class="lead mb-5">Here at Digital Dogs Australia, we provide a harmonised digital registry of pedigree dogs to breeders, dog associations, microchip registries and government bodies.
              Blockchains are an emergent technology that has broad applications.  Digital Dogs Australia harness that technology to make dog registrations more secure, transparent and affordable!</p>

            <p class="lead mb-5" id="totalSupply"></p>

            <a class="btn btn-dark btn-xl js-scroll-trigger" href="#services">Demo</a>
          </div>
        </div>
      </div>
    </section>

    <!-- Services -->
    <section class="content-section bg-primary text-white text-center" id="services">
      <div class="container">
        <div class="content-section-heading">
          <h3 class="text-secondary mb-0">Services</h3>
          <h2 class="mb-5">How it works</h2>
        </div>
        <div class="row">
          <div class="col-lg-3 col-md-6 mb-5 mb-lg-0">
            <span class="service-icon rounded-circle mx-auto mb-3">
              <i class="icon-screen-smartphone"></i>
            </span>
            <h4>
              <strong>Register</strong>
            </h4>
            <p class="text-faded mb-0">Add your dog to the ethereum blockchain!</p>
          </div>

          <div class="col-lg-3 col-md-6 mb-5 mb-lg-0">
            <span class="service-icon rounded-circle mx-auto mb-3">
              <i class="icon-magnifier"></i>
            </span>
            <h4>
              <strong>Search</strong>
            </h4>
            <p class="text-faded mb-0">Trace an animals pedigree</p>
          </div>

          <div class="col-lg-3 col-md-6 mb-5 mb-md-0">
            <span class="service-icon rounded-circle mx-auto mb-3">
              <i class="icon-people"></i>
            </span>
            <h4>
              <strong>Transfer</strong>
            </h4>
            <p class="text-faded mb-0">Securley transfer ownership</p>
          </div>

          <div class="col-lg-3 col-md-6">
            <span class="service-icon rounded-circle mx-auto mb-3">
              <i class="icon-like"></i>
            </span>
            <h4>
              <strong>Attest</strong>
            </h4>
            <p class="text-faded mb-0">Verify the ownership of your animal via our smart contracts</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Callout -->
    <section class="callout" id="register">
      <div class="container text-center">
        <h2 class="mx-auto mb-5">Register <em>your</em> dog on the blockchain!</h2>
            <div class="container-fluid">
              <form>
                  <div class="form-group">
                    <label for="name">Name</label>
                    <input type="text" class="form-control" id="name" placeholder="Enter name">
                  </div>

                  <div class="form-group">
                    <label for="name">Dob</label>
                    <input type="number" class="form-control" id="dob">
                  </div>

                  <div class="form-group">
                    <label class="radio-inline"><input type="radio" name="sex" value="0"/> Male </label>
                    <label class="radio-inline"><input type="radio" name="sex" value="1"/> Female </label>
                  </div> 

                  <div class="form-group">
                    <label for="name">Microchip</label>
                    <input type="text" class="form-control" id="microchip">
                  </div>

                  <div class="form-group">
                    <label for="name">Dam ID</label>
                    <input type="number" class="form-control" id="dam" placeholder="0">
                  </div>

                  <div class="form-group">
                    <label for="name">Sire ID</label>
                    <input type="number" class="form-control" id="sire" placeholder="0">
                  </div>

                  <div class="form-group">
                    <label for="name">Owner Public Key</label>
                    <input type="text" class="form-control" id="owner" value="0x9e1525DA6AB3498dda99B97dc13E79f4c44b79d8">
                  </div>

                  <a class="btn btn-primary btn-xl" id="register">Register</a>
              </form>
            </div>
      </div>
    </section>

    <!-- Call to Action -->
    <section class="content-section bg-primary text-white">
      <div class="container text-center">
        <h2 class="mb-4">Get in touch</h2>
        <p>We understand this technology is new and confusing.  Please email woof @ digitaldogs.io to have a chat.</p>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer text-center">
      <div class="container">
        <ul class="list-inline mb-5">
          <li class="list-inline-item">
            <a class="social-link rounded-circle text-white mr-3" href="#">
              <i class="icon-social-facebook"></i>
            </a>
          </li>
          <li class="list-inline-item">
            <a class="social-link rounded-circle text-white mr-3" href="https://www.twitter.com/digitaldogs_au">
              <i class="icon-social-twitter"></i>
            </a>
          </li>
          <li class="list-inline-item">
            <a class="social-link rounded-circle text-white" href="https://www.github.com/digitaldogs">
              <i class="icon-social-github"></i>
            </a>
          </li>
        </ul>
        <p class="text-muted small mb-0">Copyright &copy; Digital Dogs Australia 2019 Rinkeby: 0x08dd1ea8ca7c5f4264b9eb9272f506f07f94025c Mainnet: 0xa47a5021834986ddcba3528dd591b039a3b88cbd</p>
      </div>
    </footer>

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded js-scroll-trigger" href="#page-top">
      <i class="fas fa-angle-up"></i>
    </a>

    <!-- Bootstrap core JavaScript -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/stylish-portfolio.min.js"></script>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/ethjs@0.3.4/dist/ethjs.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/ethjs-abi@0.2.1/lib/index.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/ethjs-signer@0.1.1/lib/index.min.js"></script>

    <script>
      $(document).ready(function() {

        const add_abi = [
          {
            "constant": false,
            "inputs": [
              {
                "name": "name",
                "type": "string"
              },
              {
                "name": "dob",
                "type": "uint256"
              },
              {
                "name": "microchip",
                "type": "string"
              },
              {
                "name": "sex",
                "type": "uint8"
              },
              {
                "name": "dam",
                "type": "uint256"
              },
              {
                "name": "sire",
                "type": "uint256"
              },
              {
                "name": "owner",
                "type": "address"
              }
            ],
            "name": "add",
            "outputs": [],
            "payable": true,
            "stateMutability": "payable",
            "type": "function"
          }
        ]

        const totalSupply_abi = [
          {
            "constant": true,
            "inputs": [],
            "name": "totalSupply",
            "outputs": [
              {
                "name": "",
                "type": "uint256"
              }
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
          }
        ]

        const contractAddress = '0x08dd1ea8ca7c5f4264b9eb9272f506f07f94025c';
        const eth = new Eth(new Eth.HttpProvider('https://rinkeby.infura.io'));
        //const eth = new Eth(new Eth.HttpProvider('http://digitaldogs.io:8545'));

        const dog = eth.contract(totalSupply_abi).at(contractAddress);

        dog.totalSupply().then((result) => {
          $('#totalSupply').text(result[0].toString() + ' dogs registered');
        });

        $("#register").click(function() {

          //Contract owner
          eth.getTransactionCount('0x64f1cfb285350f7426b33685ed3c300aaf0937a2').then((nonce) => {
            
            const name = document.getElementById('name').value;
            const dob = document.getElementById('dob').value;
            const microchip = document.getElementById('microchip').value;
            const dam = document.getElementById('dam').value;
            const sire = document.getElementById('sire').value;
            const sex = $('input[name=sex]:checked').val();
            const owner = document.getElementById('owner').value;

            const privateKey = '0xcfdaa0e2b600272e752bd30d1bcbaf67bc1361942eb6f0236840a8903a65cd00';
            const addDogFunction = ethAbi.encodeMethod(add_abi[0], [name, dob, microchip, dam, sire, sex, owner]);

            const txParams = {
                nonce: nonce,
                gasPrice: '0x1406F40', 
                gasLimit: '0x3D0900',
                to: contractAddress, 
                value: '0xE8D4A51000', //'0x00'
                data: addDogFunction,
                chainId: 4
            }
          
            eth.sendRawTransaction(ethSigner.sign(txParams, privateKey)).then((txHash) => {
              alert('Transaction ' + txHash);
            });
        });
        });
      });
    </script>
  </body>
</html>